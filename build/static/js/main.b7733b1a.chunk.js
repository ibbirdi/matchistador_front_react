(this.webpackJsonpmatchistador_front_react=this.webpackJsonpmatchistador_front_react||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(16),s=n.n(a),o=n(17),i=n(3),u=n(2),l=n.n(u),d=n(4),p=n(9),m=n(0),h=function(e){var t=e.tracksCount,n=e.matchsCount,c=e.btnFunction;return Object(m.jsxs)("div",{className:"Dashboard",children:[Object(m.jsx)("h3",{children:"Dashboard"}),Object(m.jsxs)("div",{className:"item-row",children:[Object(m.jsxs)("div",{className:"item",children:[Object(m.jsx)("img",{src:"/img/play-button.png",alt:""}),Object(m.jsxs)("div",{className:"item-desc--container",children:[Object(m.jsx)("div",{className:"item-title",children:"Ma musique"}),Object(m.jsx)("div",{className:"item-desc",children:"".concat(t," titres")||!1})]})]}),Object(m.jsx)("button",{id:"sync-btn",className:"button",onClick:c,children:"Synchroniser"})]}),Object(m.jsx)("div",{className:"item-row",children:Object(m.jsxs)("div",{className:"item",children:[Object(m.jsx)("img",{src:"/img/match.png",alt:""}),Object(m.jsxs)("div",{className:"item-desc--container",children:[Object(m.jsx)("div",{className:"item-title",children:"Mes Matchs"}),Object(m.jsx)("div",{className:"item-desc",children:"".concat(n," Matchs")})]})]})})]})},j=function(e){var t=e.connectedUser;return Object(m.jsx)("div",{children:t})};var f=function(e){var t=e.connectedUser;return Object(m.jsx)("div",{className:"Header",children:Object(m.jsxs)("nav",{className:"",role:"navigation","aria-label":"main navigation",children:[Object(m.jsx)("div",{className:"logo",children:Object(m.jsx)("a",{className:"navbar-item",href:"/",children:Object(m.jsx)("img",{src:"/img/logodegrade.png"})})}),Object(m.jsxs)("div",{className:"connected-user",children:[Object(m.jsx)(j,{connectedUser:t}),Object(m.jsx)("img",{src:"/img/profile-user.png",alt:""})]})]})})},b="https://api.matchistador.com",x={clientId:"cd47067c9a6743619eb7c24d6b1e4c3d",clientSecret:"3d65254b4e1d4f06ad6e77471fc7a613",redirectUri:"".concat("https://www.matchistador.com","/home"),spotifyAuthCode:"",scopes:["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","app-remote-control","user-read-email","user-read-private","playlist-read-collaborative","playlist-modify-public","playlist-read-private","playlist-modify-private","user-library-modify","user-library-read","user-top-read","user-read-playback-position","user-read-recently-played","user-follow-read","user-follow-modify"],makeSpotifyConnectUrl:function(){return"https://accounts.spotify.com/authorize?response_type=code&client_id="+x.clientId+(x.scopes?"&scope="+encodeURIComponent(x.scopes):"")+"&redirect_uri="+encodeURIComponent(x.redirectUri)},init:function(){console.log("Bonjour toi")},authProcess:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),console.log("authProcess"),e.next=4,x.getToken(t);case 4:if(!localStorage.getItem("access_token")){e.next=7;break}return e.next=7,x.registerMe();case 7:localStorage.setItem("isAuth","true");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getToken:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,fetch("https://accounts.spotify.com/api/token",{method:"POST",body:"grant_type=authorization_code&code="+t+"&redirect_uri="+x.redirectUri,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(x.clientId+":"+x.clientSecret)}});case 3:return n=e.sent,e.next=6,n.json();case 6:c=e.sent,console.log(c),c?(r=c.access_token,a=c.refresh_token,localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",a),console.log(localStorage)):console.log("Erreur d'authentification");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMyInfo:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,localStorage.setItem("connected_user_name",t.display_name),localStorage.setItem("connected_user_login",t.id),console.log("Infos: ",t),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/user/").concat(localStorage.getItem("connected_user_login"),"/tracks"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchs"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMyTopTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],c="https://api.spotify.com/v1/me/top/tracks?time_range=".concat(t,"&limit=50"),e.prev=2,e.next=5,fetch(c,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 5:return r=e.sent,e.next=8,r.json();case 8:return r=e.sent,console.log(r),r.items.forEach((function(e){n.push({artist:e.artists[0].name,track:e.name,album:e.album.name,popularity:e.popularity,spotify_id:e.id,spotify_url:e.uri,spotify_img_url:"",spotify_preview_url:e.preview_url})})),console.log("top tracks: ",n),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",console.error(e.t0));case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),getMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c,r,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=function(){var e=Object(d.a)(l.a.mark((function e(n){var c,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return c=e.sent,e.next=5,c.json();case 5:if(c=e.sent,r=document.getElementById("sync-btn"),o=Math.floor(a.length/(c.total+s)*100),r.setAttribute("disabled","disabled"),r.textContent=o+"%",r.classList.add("wait"),console.log(o+"%"),c.items.forEach((function(e){a.push({artist:e.track.artists[0].name,track:e.track.name,album:e.track.album.name,popularity:e.track.popularity,spotify_id:e.track.id,spotify_url:e.track.uri,spotify_img_url:"",spotify_preview_url:e.track.preview_url})})),!c.next){e.next=17;break}return e.abrupt("return",t(c.next));case 17:return r.textContent="Et voil\xe0 !",r.classList.toggle("wait"),r.classList.toggle("success"),e.next=22,x.syncMyTracks(a);case 22:return e.next=24,x.syncMyMatchs();case 24:return e.abrupt("return",a.length);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,x.getMyTopTracks("long_term");case 4:return n=e.sent,e.next=7,x.getMyTopTracks("medium_term");case 7:return c=e.sent,e.next=10,x.getMyTopTracks("short_term");case 10:return r=e.sent,a=(a=[]).concat(n,c,r),console.log("top tracks RESULT :",a.length),s=a.length,"https://api.spotify.com/v1/me/tracks?limit=50",e.next=18,t("https://api.spotify.com/v1/me/tracks?limit=50");case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}(),registerMe:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return t=e.sent,console.log(t),n={name:t.display_name,spotify_login:t.id,email:t.email},console.log(JSON.stringify(n)),e.next=8,fetch("".concat(b,"/user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 8:return c=e.sent,e.t0=console,e.next=12,c.json();case 12:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),syncMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return n=e.sent,c=n.id,e.next=6,fetch("".concat(b,"/user/").concat(c,"/tracks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 6:return r=e.sent,e.t0=console,e.next=10,r.json();case 10:return e.t1=e.sent,e.abrupt("return",e.t0.log.call(e.t0,e.t1));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),syncMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return t=e.sent,n=t.id,e.next=6,fetch("".concat(b,"/user/").concat(n,"/syncmatchs"));case 6:return c=e.sent,e.t0=console,e.next=10,c.json();case 10:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMatchedTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchedtracks/").concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};document.addEventListener("DOMContentLoaded",x.init);var g=x,v=function(){document.getElementById("tracksboard").classList.add("hidden")},O=function(e){var t=e.matchName,n=e.matchedTracks;return Object(m.jsx)("div",{className:"Tracksboard hidden",id:"tracksboard",children:Object(m.jsxs)("div",{className:"trackslist",children:[Object(m.jsxs)("div",{className:"tracksboard-title",onClick:v,children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"logo-m",children:Object(m.jsx)("img",{src:"/img/logo-m.png",alt:""})}),t]}),Object(m.jsx)("div",{className:"closebtn",children:Object(m.jsx)("img",{src:"/img/cancel-white.png",alt:""})})]}),n.map((function(e){return Object(m.jsxs)("div",{className:"track-container",children:[Object(m.jsx)("div",{className:"artist",children:e.artist}),Object(m.jsxs)("div",{className:"track",children:[e.track," (",e.popularity,")"]})]},e.id)})),Object(m.jsxs)("div",{children:["Total : ",n.length]})]})})},y=function(e){var t=e.matchs,n=Object(c.useState)([]),r=Object(p.a)(n,2),a=r[0],s=r[1],o=Object(c.useState)(""),i=Object(p.a)(o,2),u=i[0],h=i[1],j=Object(c.useState)([]),f=Object(p.a)(j,2),b=f[0],x=f[1],v=function(){var e=Object(d.a)(l.a.mark((function e(t,n){var c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.getMatchedTracks(n);case 2:c=e.sent,document.getElementById("tracksboard").classList.remove("hidden"),s(c),h(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){x(t)}),[t]);return Object(m.jsxs)("div",{className:"Matchboard",children:[Object(m.jsxs)("div",{className:"title-container",children:[Object(m.jsx)("h3",{children:"Mes Matchs"}),Object(m.jsx)("input",{className:"searchInput",type:"text",placeholder:"Rechercher...",onChange:function(e){var n=t.filter((function(t){return t.matchuser.name.toLowerCase().includes(e.target.value.toLowerCase())}));x(n),console.log(n)}})]}),b.map((function(e){return Object(m.jsxs)("div",{className:"item-row",onClick:function(){v(e.matchuser.name,e.matchuser.spotify_login)},children:[Object(m.jsxs)("div",{className:"item",children:[Object(m.jsx)("span",{className:"logo-m shadow",children:Object(m.jsx)("img",{src:"/img/logo-m.png",alt:""})}),Object(m.jsx)("div",{className:"item-title",children:e.matchuser.name})]}),Object(m.jsxs)("div",{className:"item-desc--container",children:[Object(m.jsxs)("div",{className:"score",children:[e.score," points"]}),Object(m.jsxs)("div",{className:"item-desc",children:[e.tracksQty," titres en commun"]})]})]},e.matchuser.spotify_login)})),Object(m.jsx)(O,{matchedTracks:a,matchName:u})]})},k=function(){var e=Object(c.useState)("Chargement..."),t=Object(p.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)("Chargement..."),s=Object(p.a)(a,2),o=s[0],i=s[1],u=Object(c.useState)([]),j=Object(p.a)(u,2),b=j[0],x=j[1],v=Object(c.useState)([]),k=Object(p.a)(v,2),w=k[0],_=k[1],N=Object(c.useState)([]),S=Object(p.a)(N,2),M=S[0],T=S[1],I=Object(c.useState)(!0),C=Object(p.a)(I,2),E=C[0],U=C[1],L=function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.getMyTracks();case 3:return e.next=5,g.showMyTracks();case 5:return t=e.sent,e.next=8,g.showMyMatchs();case 8:n=e.sent,x(t),_(n),console.log("SET EXECUTE"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=g.getMatchedTracks(t),T(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E){e.next=17;break}if(t=new URL(window.location.href),!(n=t.searchParams.get("code"))||"true"===localStorage.getItem("isAuth")){e.next=6;break}return e.next=6,g.authProcess(n);case 6:return e.next=8,g.showMyTracks();case 8:return c=e.sent,e.next=11,g.showMyMatchs();case 11:a=e.sent,r(localStorage.getItem("connected_user_name")),x(c),_(a),i("Hello"),U(!1);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[E]),Object(m.jsxs)("div",{className:"Home",children:[Object(m.jsx)(f,{connectedUser:n}),Object(m.jsxs)("div",{className:"home-container",children:[Object(m.jsx)("h2",{children:o}),Object(m.jsx)(h,{tracksCount:b.length,matchsCount:w.length,btnFunction:L}),Object(m.jsx)(y,{matchs:w,clickFunction:B}),Object(m.jsx)(O,{matchedTracks:M})]})]})},w=function(){var e=g.makeSpotifyConnectUrl();return localStorage.clear(),console.log(localStorage),Object(m.jsxs)("div",{className:"landing-page",children:[Object(m.jsx)(f,{}),Object(m.jsxs)("div",{className:"connexion",children:[Object(m.jsx)("h1",{children:"Bienvenue"}),Object(m.jsx)("a",{href:e,children:Object(m.jsxs)("div",{className:"spotify-connect--btn",children:["Se connecter avec",Object(m.jsx)("img",{className:"spotify-connect--img",src:"/img/spotifyWhite.png",alt:""})]})})]})]})},_=function(){return Object(m.jsxs)("div",{children:[Object(m.jsx)(f,{}),Object(m.jsx)("h1",{children:"Not Found"})]})};var N=function(){return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(o.a,{children:Object(m.jsxs)(i.c,{children:[Object(m.jsx)(i.a,{path:"/",exact:!0,component:w}),Object(m.jsx)(i.a,{path:"/home",exact:!0,component:k}),Object(m.jsx)(i.a,{component:_})]})})})};n(33);s.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(N,{})}),document.getElementById("root"))}},[[34,1,2]]]);