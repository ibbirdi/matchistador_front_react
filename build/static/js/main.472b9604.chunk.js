(this.webpackJsonpmatchistador_front_react=this.webpackJsonpmatchistador_front_react||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(17),s=n.n(a),o=n(14),i=n(3),u=n(2),l=n.n(u),d=n(4),p=n(9),m="https://api.matchistador.com",h={clientId:"cd47067c9a6743619eb7c24d6b1e4c3d",clientSecret:"3d65254b4e1d4f06ad6e77471fc7a613",redirectUri:"".concat("https://www.matchistador.com","/home"),spotifyAuthCode:"",scopes:["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","app-remote-control","user-read-email","user-read-private","playlist-read-collaborative","playlist-modify-public","playlist-read-private","playlist-modify-private","user-library-modify","user-library-read","user-top-read","user-read-playback-position","user-read-recently-played","user-follow-read","user-follow-modify"],makeSpotifyConnectUrl:function(){return"https://accounts.spotify.com/authorize?response_type=code&client_id="+h.clientId+(h.scopes?"&scope="+encodeURIComponent(h.scopes):"")+"&redirect_uri="+encodeURIComponent(h.redirectUri)},init:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Bonjour toi");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),authProcess:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),console.log("authProcess"),e.next=4,h.getToken(t);case 4:if(!localStorage.getItem("access_token")){e.next=7;break}return e.next=7,h.registerMe();case 7:localStorage.setItem("isAuth","true");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getToken:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,fetch("https://accounts.spotify.com/api/token",{method:"POST",body:"grant_type=authorization_code&code="+t+"&redirect_uri="+h.redirectUri,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(h.clientId+":"+h.clientSecret)}});case 3:return n=e.sent,e.next=6,n.json();case 6:c=e.sent,console.log(c),c?(r=c.access_token,a=c.refresh_token,localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",a),console.log(localStorage)):console.log("Erreur d'authentification");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMyInfo:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,localStorage.setItem("connected_user_name",t.display_name),localStorage.setItem("connected_user_login",t.id),console.log("Infos: ",t),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/user/").concat(localStorage.getItem("connected_user_login"),"/tracks"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchs"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMyTopTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],c="https://api.spotify.com/v1/me/top/tracks?time_range=".concat(t,"&limit=50"),e.prev=2,e.next=5,fetch(c,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 5:return r=e.sent,e.next=8,r.json();case 8:return r=e.sent,console.log(r),r.items.forEach((function(e){n.push({artist:e.artists[0].name,track:e.name,album:e.album.name,popularity:e.popularity,spotify_id:e.id,spotify_url:e.uri,spotify_img_url:"",spotify_preview_url:e.preview_url})})),console.log("top tracks: ",n),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",console.error(e.t0));case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),getMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c,r,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=function(){var e=Object(d.a)(l.a.mark((function e(n){var c,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return c=e.sent,e.next=5,c.json();case 5:if(c=e.sent,r=document.getElementById("sync-btn"),o=Math.floor(a.length/(c.total+s)*100),r.setAttribute("disabled","disabled"),r.textContent=o+"%",console.log(o+"%"),c.items.forEach((function(e){a.push({artist:e.track.artists[0].name,track:e.track.name,album:e.track.album.name,popularity:e.track.popularity,spotify_id:e.track.id,spotify_url:e.track.uri,spotify_img_url:"",spotify_preview_url:e.track.preview_url})})),!c.next){e.next=16;break}t(c.next),e.next=20;break;case 16:return e.next=18,h.syncMyMatchs();case 18:return r.textContent="Termin\xe9 !",e.abrupt("return",h.syncMyTracks(a));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,h.getMyTopTracks("long_term");case 4:return n=e.sent,e.next=7,h.getMyTopTracks("medium_term");case 7:return c=e.sent,e.next=10,h.getMyTopTracks("short_term");case 10:r=e.sent,a=(a=[]).concat(n,c,r),console.log("top tracks RESULT :",a.length),s=a.length,"https://api.spotify.com/v1/me/tracks?limit=50",t("https://api.spotify.com/v1/me/tracks?limit=50"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.error(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(){return e.apply(this,arguments)}}(),registerMe:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.getMyInfo();case 2:return t=e.sent,console.log(t),n={name:t.display_name,spotify_login:t.id,email:t.email},console.log(JSON.stringify(n)),e.next=8,fetch("".concat(m,"/user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 8:return c=e.sent,e.t0=console,e.next=12,c.json();case 12:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),syncMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.getMyInfo();case 2:return n=e.sent,c=n.id,console.log(c),e.next=7,fetch("".concat(m,"/user/").concat(c,"/tracks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 7:return r=e.sent,e.t0=console,e.next=11,r.json();case 11:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),syncMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.getMyInfo();case 2:return t=e.sent,n=t.id,e.next=6,fetch("".concat(m,"/user/").concat(n,"/syncmatchs"));case 6:return c=e.sent,e.t0=console,e.next=10,c.json();case 10:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMatchedTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchedtracks/").concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};document.addEventListener("DOMContentLoaded",h.init);var j=h,f=n(0),b=function(e){return Object(f.jsxs)("div",{className:"Dashboard",children:[Object(f.jsx)("h3",{children:"Dashboard"}),Object(f.jsxs)("div",{className:"item-row",children:[Object(f.jsxs)("div",{className:"item",children:[Object(f.jsx)("img",{src:"/img/play-button.png",alt:""}),Object(f.jsxs)("div",{className:"item-desc--container",children:[Object(f.jsx)("div",{className:"item-title",children:"Ma musique"}),Object(f.jsx)("div",{className:"item-desc",children:"".concat(e.tracksCount," titres")||!1})]})]}),Object(f.jsx)("button",{id:"sync-btn",className:"button",onClick:e.btnFunction,children:"Synchroniser"})]}),Object(f.jsx)("div",{className:"item-row",children:Object(f.jsxs)("div",{className:"item",children:[Object(f.jsx)("img",{src:"/img/match.png",alt:""}),Object(f.jsxs)("div",{className:"item-desc--container",children:[Object(f.jsx)("div",{className:"item-title",children:"Mes Matchs"}),Object(f.jsx)("div",{className:"item-desc",children:"".concat(e.matchsCount," Matchs")})]})]})})]})},x=function(e){return Object(f.jsxs)("div",{children:[" ",e.connectedUser]})};var g=function(e){return Object(f.jsx)("div",{className:"Header",children:Object(f.jsxs)("nav",{className:"",role:"navigation","aria-label":"main navigation",children:[Object(f.jsx)("div",{className:"logo",children:Object(f.jsx)("a",{className:"navbar-item",href:"/",children:Object(f.jsx)("img",{src:"/img/logodegrade.png"})})}),Object(f.jsxs)("div",{className:"connected-user",children:[Object(f.jsx)(x,{connectedUser:e.connectedUser}),Object(f.jsx)("img",{src:"/img/profile-user.png",alt:""})]})]})})},v=function(){document.getElementById("tracksboard").classList.add("hidden")},y=function(e){return Object(f.jsx)("div",{className:"Tracksboard hidden",id:"tracksboard",children:Object(f.jsxs)("div",{className:"trackslist",children:[Object(f.jsxs)("div",{className:"tracksboard-title",onClick:v,children:[Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"logo-m",children:Object(f.jsx)("img",{src:"/img/logo-m.png",alt:""})}),e.matchName]}),Object(f.jsx)("div",{className:"closebtn",children:Object(f.jsx)("img",{src:"/img/cancel-white.png",alt:""})})]}),e.matchedTracks.map((function(e){return Object(f.jsxs)("div",{className:"track-container",children:[Object(f.jsx)("div",{className:"artist",children:e.artist}),Object(f.jsxs)("div",{className:"track",children:[e.track," (",e.popularity,")"]})]},e.id)})),Object(f.jsxs)("div",{children:["Total : ",e.matchedTracks.length]})]})})},O=function(e){var t=Object(c.useState)([]),n=Object(p.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(""),o=Object(p.a)(s,2),i=o[0],u=o[1],m=function(){var e=Object(d.a)(l.a.mark((function e(t,n){var c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getMatchedTracks(n);case 2:c=e.sent,document.getElementById("tracksboard").classList.remove("hidden"),a(c),u(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(f.jsxs)("div",{className:"Matchboard",children:[Object(f.jsx)("h3",{children:"Mes Matchs"}),e.matchs.map((function(e){return Object(f.jsxs)("div",{className:"item-row",onClick:function(){m(e.matchuser.name,e.matchuser.spotify_login)},children:[Object(f.jsxs)("div",{className:"item",children:[Object(f.jsx)("span",{className:"logo-m shadow",children:Object(f.jsx)("img",{src:"/img/logo-m.png",alt:""})}),Object(f.jsx)("div",{className:"item-title",children:e.matchuser.name})]}),Object(f.jsxs)("div",{className:"item-desc--container",children:[Object(f.jsxs)("div",{className:"score",children:[e.score," points"]}),Object(f.jsxs)("div",{className:"item-desc",children:[e.tracksQty," titres en commun"]})]})]},e.matchuser.spotify_login)})),Object(f.jsx)(y,{matchedTracks:r,matchName:i})]})},k=function(){var e=Object(c.useState)(""),t=Object(p.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)([]),s=Object(p.a)(a,2),o=s[0],i=s[1],u=Object(c.useState)([]),m=Object(p.a)(u,2),h=m[0],x=m[1],v=Object(c.useState)([]),k=Object(p.a)(v,2),w=k[0],_=k[1],N=Object(c.useState)(!0),M=Object(p.a)(N,2),T=M[0],S=M[1],I=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.getMyTracks();case 3:return e.t0=i,e.next=6,j.showMyTracks();case 6:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=x,e.next=11,j.showMyMatchs();case 11:e.t3=e.sent,(0,e.t2)(e.t3),e.next=18;break;case 15:e.prev=15,e.t4=e.catch(0),console.error(e.t4);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=j.getMatchedTracks(t),_(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)(Object(d.a)(l.a.mark((function e(){var t,n,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!T){e.next=16;break}if(t=new URL(window.location.href),!(n=t.searchParams.get("code"))||"true"==localStorage.getItem("isAuth")){e.next=6;break}return e.next=6,j.authProcess(n);case 6:return e.next=8,j.showMyTracks();case 8:return c=e.sent,e.next=11,j.showMyMatchs();case 11:a=e.sent,r(localStorage.getItem("connected_user_name")),i(c),x(a),S(!1);case 16:case"end":return e.stop()}}),e)}))),[]),Object(f.jsxs)("div",{className:"Home",children:[Object(f.jsx)(g,{connectedUser:n}),Object(f.jsxs)("div",{className:"home-container",children:[Object(f.jsx)("h2",{children:"Hello"}),Object(f.jsx)(b,{tracksCount:o.length,matchsCount:h.length,btnFunction:I}),Object(f.jsx)(O,{matchs:h,clickFunction:C}),Object(f.jsx)(y,{matchedTracks:w})]})]})},w=function(){var e=j.makeSpotifyConnectUrl();return localStorage.clear(),Object(f.jsxs)("div",{className:"landing-page",children:[Object(f.jsx)(g,{}),Object(f.jsxs)("div",{className:"connexion",children:[Object(f.jsx)("h1",{children:"Bienvenue"}),Object(f.jsx)("a",{href:e,children:Object(f.jsxs)("div",{className:"spotify-connect--btn",children:["Se connecter avec",Object(f.jsx)("img",{className:"spotify-connect--img",src:"/img/spotifyWhite.png",alt:""})]})})]})]})},_=function(){return Object(f.jsxs)("div",{children:[Object(f.jsx)(g,{}),Object(f.jsx)("h1",{children:"Not Found"})]})};var N=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(o.a,{children:Object(f.jsxs)(i.c,{children:[Object(f.jsx)(i.a,{path:"/",exact:!0,component:w}),Object(f.jsx)(i.a,{path:"/home",exact:!0,component:k}),Object(f.jsx)(i.a,{component:_})]})})})};n(33);s.a.render(Object(f.jsx)(r.a.StrictMode,{children:Object(f.jsx)(N,{})}),document.getElementById("root"))}},[[34,1,2]]]);