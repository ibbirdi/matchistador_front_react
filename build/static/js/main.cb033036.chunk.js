(this.webpackJsonpmatchistador_front_react=this.webpackJsonpmatchistador_front_react||[]).push([[0],{33:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(16),s=n.n(a),o=n(17),i=n(4),u=n(2),l=n.n(u),d=n(3),p=n(6),h=n(0),m=function(e){var t=e.tracksCount,n=e.matchsCount,r=e.btnFunction;return Object(h.jsxs)("div",{className:"Dashboard",children:[Object(h.jsxs)("div",{className:"item-row",children:[Object(h.jsxs)("div",{className:"item",children:[Object(h.jsx)("img",{src:"/img/play-button.png",alt:""}),Object(h.jsxs)("div",{className:"item-desc--container",children:[Object(h.jsx)("div",{className:"item-title",children:"Ma musique"}),Object(h.jsx)("div",{className:"item-desc",children:"".concat(t," titres")||!1})]})]}),Object(h.jsx)("button",{id:"sync-btn",className:"button",onClick:r,children:"Synchroniser"})]}),Object(h.jsx)("div",{className:"item-row",children:Object(h.jsxs)("div",{className:"item",children:[Object(h.jsx)("img",{src:"/img/match.png",alt:""}),Object(h.jsxs)("div",{className:"item-desc--container",children:[Object(h.jsx)("div",{className:"item-title",children:"Mes Matchs"}),Object(h.jsx)("div",{className:"item-desc",children:"".concat(n," Matchs")})]})]})})]})},j="https://api.matchistador.com",f={clientId:"cd47067c9a6743619eb7c24d6b1e4c3d",clientSecret:"3d65254b4e1d4f06ad6e77471fc7a613",redirectUri:"".concat("https://www.matchistador.com","/home"),spotifyAuthCode:"",scopes:["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","app-remote-control","user-read-email","user-read-private","playlist-read-collaborative","playlist-modify-public","playlist-read-private","playlist-modify-private","user-library-modify","user-library-read","user-top-read","user-read-playback-position","user-read-recently-played","user-follow-read","user-follow-modify"],makeSpotifyConnectUrl:function(){return"https://accounts.spotify.com/authorize?response_type=code&client_id="+f.clientId+(f.scopes?"&scope="+encodeURIComponent(f.scopes):"")+"&redirect_uri="+encodeURIComponent(f.redirectUri)},authProcess:function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),console.log("authProcess"),e.next=4,f.getToken(t);case 4:if(!localStorage.getItem("access_token")){e.next=7;break}return e.next=7,f.registerMe();case 7:localStorage.setItem("isAuth","true");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),registerMe:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.syncMyInfo();case 2:return t=e.sent,console.log(t),n={name:t.display_name,spotify_login:t.id,email:t.email},console.log(JSON.stringify(n)),e.next=8,fetch("".concat(j,"/user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 8:return r=e.sent,e.t0=console,e.next=12,r.json();case 12:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getToken:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,fetch("https://accounts.spotify.com/api/token",{method:"POST",body:"grant_type=authorization_code&code="+t+"&redirect_uri="+f.redirectUri,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(f.clientId+":"+f.clientSecret)}});case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,console.log(r),r?(c=r.access_token,a=r.refresh_token,localStorage.setItem("access_token",c),localStorage.setItem("refresh_token",a),console.log(localStorage)):console.log("Erreur d'authentification");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMyInfoFromSpotify:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,console.log("GMIFS",t),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),syncMyInfo:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getMyInfoFromSpotify();case 2:return t=e.sent,e.next=5,fetch("".concat(j,"/user/").concat(t.id,"/info"));case 5:return n=e.sent,e.next=8,n.json();case 8:return n=e.sent,localStorage.setItem("connected_user_name",n.name),localStorage.setItem("connected_user_login",t.id),console.log("Infos: ",t),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMyInfo:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getMyInfoFromSpotify();case 2:return t=e.sent,e.next=5,fetch("".concat(j,"/user/").concat(t.id,"/info"));case 5:return n=e.sent,e.next=8,n.json();case 8:return n=e.sent,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),changeMyUsername:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify({newusername:t}),e.next=3,f.getMyInfoFromSpotify();case 3:return r=e.sent,e.next=6,fetch("".concat(j,"/user/").concat(r.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:n});case 6:return c=e.sent,e.next=9,c.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),showMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(j,"/user/").concat(localStorage.getItem("connected_user_login"),"/tracks"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(j,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchs"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMyTopTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r="https://api.spotify.com/v1/me/top/tracks?time_range=".concat(t,"&limit=50"),e.prev=2,e.next=5,fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 5:return c=e.sent,e.next=8,c.json();case 8:return c=e.sent,console.log(c),c.items.forEach((function(e){n.push({artist:e.artists[0].name,track:e.name,album:e.album.name,popularity:e.popularity,spotify_id:e.id,spotify_url:e.uri,spotify_img_url:"",spotify_preview_url:e.preview_url})})),console.log("top tracks: ",n),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",console.error(e.t0));case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),getMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r,c,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=function(){var e=Object(d.a)(l.a.mark((function e(n){var r,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return r=e.sent,e.next=5,r.json();case 5:if(r=e.sent,c=document.getElementById("sync-btn"),o=Math.floor(a.length/(r.total+s)*100),c.setAttribute("disabled","disabled"),c.textContent=o+"%",c.classList.add("wait"),console.log(o+"%"),r.items.forEach((function(e){a.push({artist:e.track.artists[0].name,track:e.track.name,album:e.track.album.name,popularity:e.track.popularity,spotify_id:e.track.id,spotify_url:e.track.uri,spotify_img_url:"",spotify_preview_url:e.track.preview_url})})),!r.next){e.next=17;break}return e.abrupt("return",t(r.next));case 17:return c.textContent="Et voil\xe0 !",c.classList.toggle("wait"),c.classList.toggle("success"),e.next=22,f.syncMyTracks(a);case 22:return e.next=24,f.syncMyMatchs();case 24:return e.abrupt("return",a.length);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,f.getMyTopTracks("long_term");case 4:return n=e.sent,e.next=7,f.getMyTopTracks("medium_term");case 7:return r=e.sent,e.next=10,f.getMyTopTracks("short_term");case 10:return c=e.sent,a=(a=[]).concat(n,r,c),console.log("top tracks RESULT :",a.length),s=a.length,"https://api.spotify.com/v1/me/tracks?limit=50",e.next=18,t("https://api.spotify.com/v1/me/tracks?limit=50");case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}(),syncMyTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.syncMyInfo();case 2:return n=e.sent,r=n.id,e.next=6,fetch("".concat(j,"/user/").concat(r,"/tracks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 6:return c=e.sent,e.t0=console,e.next=10,c.json();case 10:return e.t1=e.sent,e.abrupt("return",e.t0.log.call(e.t0,e.t1));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),syncMyMatchs:function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.syncMyInfo();case 2:return t=e.sent,n=t.id,e.next=6,fetch("".concat(j,"/user/").concat(n,"/syncmatchs"));case 6:return r=e.sent,e.t0=console,e.next=10,r.json();case 10:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMatchedTracks:function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(j,"/user/").concat(localStorage.getItem("connected_user_login"),"/matchedtracks/").concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},b=f,x=function(e){var t=e.username;return Object(h.jsx)("div",{className:"connectstatus",children:Object(h.jsx)("a",{href:"/profil",children:Object(h.jsxs)("div",{className:"connecteduser-container",href:"/profile",children:[Object(h.jsx)("div",{children:t}),Object(h.jsx)("img",{src:"/img/profile-user.png",alt:""})]})})})};var v=function(e){var t=e.username;return Object(h.jsx)("div",{className:"Header",children:Object(h.jsxs)("nav",{className:"",role:"navigation","aria-label":"main navigation",children:[Object(h.jsx)("div",{className:"logo",children:Object(h.jsx)("a",{className:"navbar-item",href:"/",children:Object(h.jsx)("img",{src:"/img/logodegrade.png",alt:"logo"})})}),Object(h.jsx)("div",{className:"connected-user",children:Object(h.jsx)(x,{username:t})})]})})},g=function(){document.getElementById("tracksboard").classList.add("hidden")},O=function(e){var t=e.matchName,n=e.matchedTracks;return Object(h.jsx)("div",{className:"Tracksboard hidden",id:"tracksboard",children:Object(h.jsxs)("div",{className:"trackslist",children:[Object(h.jsxs)("div",{className:"tracksboard-title",children:[Object(h.jsx)("div",{children:Object(h.jsxs)("div",{className:"logo-m",children:[Object(h.jsx)("img",{src:"/img/logo-m.png",alt:""}),t]})}),Object(h.jsx)("div",{className:"closebtn",onClick:g,children:Object(h.jsx)("img",{src:"/img/cancel-white.png",alt:""})})]}),n.map((function(e){return Object(h.jsxs)("div",{className:"track-container",children:[Object(h.jsx)("div",{className:"artist",children:e.artist}),Object(h.jsxs)("div",{className:"track",children:[e.track," (",e.popularity,")"]})]},e.id)})),Object(h.jsxs)("div",{children:["Total : ",n.length]})]})})},y=function(e){var t=e.matchs,n=Object(r.useState)([]),c=Object(p.a)(n,2),a=c[0],s=c[1],o=Object(r.useState)(""),i=Object(p.a)(o,2),u=i[0],m=i[1],j=Object(r.useState)([]),f=Object(p.a)(j,2),x=f[0],v=f[1],g=function(){var e=Object(d.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.getMatchedTracks(n);case 2:r=e.sent,document.getElementById("tracksboard").classList.remove("hidden"),s(r),m(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){v(t)}),[t]);return Object(h.jsxs)("div",{className:"Matchboard",children:[Object(h.jsxs)("div",{className:"title-container",children:[Object(h.jsx)("h3",{children:"Mes Matchs"}),Object(h.jsx)("input",{className:"searchInput",type:"text",placeholder:"Rechercher...",onChange:function(e){var n=t.filter((function(t){return t.matchuser.name.toLowerCase().includes(e.target.value.toLowerCase())}));v(n),console.log(n)}})]}),x.map((function(e){return Object(h.jsxs)("div",{className:"item-row",onClick:function(){g(e.matchuser.name,e.matchuser.spotify_login)},children:[Object(h.jsxs)("div",{className:"item",children:[Object(h.jsx)("span",{className:"logo-m shadow",children:Object(h.jsx)("img",{src:"/img/logo-m.png",alt:""})}),Object(h.jsx)("div",{className:"item-title",children:e.matchuser.name})]}),Object(h.jsxs)("div",{className:"item-desc--container",children:[Object(h.jsxs)("div",{className:"score",children:[e.score," points"]}),Object(h.jsxs)("div",{className:"item-desc",children:[e.tracksQty," titres en commun"]})]})]},e.matchuser.spotify_login)})),Object(h.jsx)(O,{matchedTracks:a,matchName:u})]})},k=function(){var e=Object(r.useState)("Chargement..."),t=Object(p.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)([]),s=Object(p.a)(a,2),o=s[0],i=s[1],u=Object(r.useState)([]),j=Object(p.a)(u,2),f=j[0],x=j[1],g=Object(r.useState)("Chargement..."),k=Object(p.a)(g,2),w=k[0],N=k[1],M=Object(r.useState)([]),S=Object(p.a)(M,2),_=S[0],T=S[1],I=Object(r.useState)(!0),C=Object(p.a)(I,2),E=C[0],U=C[1],A=function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c("Synchronisation en cours..."),e.next=4,b.getMyTracks();case 4:return e.next=6,b.showMyTracks();case 6:return t=e.sent,e.next=9,b.showMyMatchs();case 9:n=e.sent,i(t),x(n),c("Termin\xe9 !"),setTimeout((function(){c("Hello")}),2e3),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b.getMatchedTracks(t),T(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){(function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E){e.next=20;break}if(t=new URL(window.location.href),!(n=t.searchParams.get("code"))||"true"===localStorage.getItem("isAuth")){e.next=6;break}return e.next=6,b.authProcess(n);case 6:return e.next=8,b.showMyTracks();case 8:return r=e.sent,e.next=11,b.showMyMatchs();case 11:return a=e.sent,e.next=14,b.getMyInfo();case 14:s=e.sent,i(r),x(a),N(s.name),c("Hello"),U(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[E]),Object(h.jsxs)("div",{className:"Home",children:[Object(h.jsx)(v,{username:w}),Object(h.jsxs)("div",{className:"main-container",children:[Object(h.jsx)("h2",{children:n}),Object(h.jsx)(m,{tracksCount:o.length,matchsCount:f.length,btnFunction:A}),Object(h.jsx)(y,{matchs:f,clickFunction:P}),Object(h.jsx)(O,{matchedTracks:_})]})]})},w=function(){var e=b.makeSpotifyConnectUrl();return localStorage.clear(),console.log(localStorage),Object(h.jsxs)("div",{className:"landing-page",children:[Object(h.jsx)(v,{}),Object(h.jsxs)("div",{className:"connexion",children:[Object(h.jsx)("h1",{children:"Bienvenue"}),Object(h.jsx)("a",{href:e,children:Object(h.jsxs)("div",{className:"spotify-connect--btn",children:["Se connecter avec",Object(h.jsx)("img",{className:"spotify-connect--img",src:"/img/spotifyWhite.png",alt:""})]})})]})]})},N=function(){return Object(h.jsxs)("div",{children:[Object(h.jsx)(v,{}),Object(h.jsx)("h1",{children:"Not Found"})]})},M=function(e){var t=e.title,n=e.children;return Object(h.jsxs)("div",{className:"Card1",children:[Object(h.jsx)("div",{className:"title-container",children:Object(h.jsx)("h3",{children:t})}),n]})},S=function(){var e=Object(r.useState)("Chargement..."),t=Object(p.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(""),s=Object(p.a)(a,2),o=s[0],i=s[1],u=Object(r.useState)(""),m=Object(p.a)(u,2),j=m[0],f=m[1],x=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,b.getMyInfo();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=4;break}f("Username invalide"),e.next=11;break;case 4:return e.next=6,b.changeMyUsername(o);case 6:return t=e.sent,e.next=9,b.syncMyInfo();case 9:x(),f(t.message);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){x()}),[]),Object(h.jsxs)("div",{children:[Object(h.jsx)(v,{username:n.name}),Object(h.jsxs)("div",{className:"main-container",children:[Object(h.jsx)("h2",{children:"Profil"}),Object(h.jsxs)(M,{title:"Pseudo : "+n.name,children:[Object(h.jsxs)("div",{className:"input-container",children:[Object(h.jsx)("input",{type:"text",placeholder:"Changer de pseudo",onChange:function(e){return i(e.target.value)}}),Object(h.jsx)("button",{className:"button",type:"submit",onClick:g,children:"Ok"})]}),Object(h.jsx)("h4",{children:j}),Object(h.jsx)("a",{href:"/home",className:"button",children:"Retour"})]})]})]})};var _=function(){return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(o.a,{children:Object(h.jsxs)(i.c,{children:[Object(h.jsx)(i.a,{path:"/",exact:!0,component:w}),Object(h.jsx)(i.a,{path:"/home",exact:!0,component:k}),Object(h.jsx)(i.a,{path:"/profil",exact:!0,component:S}),Object(h.jsx)(i.a,{component:N})]})})})};n(33);s.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(_,{})}),document.getElementById("root"))}},[[34,1,2]]]);