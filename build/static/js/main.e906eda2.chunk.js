(this.webpackJsonpmatchistador_front_react=this.webpackJsonpmatchistador_front_react||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(16),s=n.n(c),o=n(13),i=n(3),u=n(2),l=n.n(u),p=n(5),m=n(17),d=n(18),h=n(21),f=n(20),j=n(0),b="https://api.matchistador.com",x={clientId:"cd47067c9a6743619eb7c24d6b1e4c3d",clientSecret:"3d65254b4e1d4f06ad6e77471fc7a613",redirectUri:"".concat("https://www.matchistador.com","/home"),spotifyAuthCode:"",scopes:["ugc-image-upload","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","app-remote-control","user-read-email","user-read-private","playlist-read-collaborative","playlist-modify-public","playlist-read-private","playlist-modify-private","user-library-modify","user-library-read","user-top-read","user-read-playback-position","user-read-recently-played","user-follow-read","user-follow-modify"],makeSpotifyConnectUrl:function(){return"https://accounts.spotify.com/authorize?response_type=code&client_id="+x.clientId+(x.scopes?"&scope="+encodeURIComponent(x.scopes):"")+"&redirect_uri="+encodeURIComponent(x.redirectUri)},init:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Bonjour toi");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),authProcess:function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),console.log("authProcess"),e.next=4,x.getToken(t);case 4:if(!localStorage.getItem("access_token")){e.next=7;break}return e.next=7,x.registerMe();case 7:localStorage.setItem("isAuth","true");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getToken:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,fetch("https://accounts.spotify.com/api/token",{method:"POST",body:"grant_type=authorization_code&code="+t+"&redirect_uri="+x.redirectUri,headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(x.clientId+":"+x.clientSecret)}});case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,console.log(r),r?(a=r.access_token,c=r.refresh_token,localStorage.setItem("access_token",a),localStorage.setItem("refresh_token",c),console.log(localStorage)):console.log("Erreur d'authentification");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMyInfo:function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,localStorage.setItem("connected_user_name",t.display_name),localStorage.setItem("connected_user_login",t.id),console.log("Infos: ",t),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),showMyTracks:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/user/").concat(t,"/tracks"));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),showMyMatchs:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/user/").concat(t,"/matchs"));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getMyTopTracks:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r="https://api.spotify.com/v1/me/top/tracks?time_range=".concat(t,"&limit=50"),e.prev=2,e.next=5,fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 5:return a=e.sent,e.next=8,a.json();case 8:return a=e.sent,console.log(a),a.items.forEach((function(e){n.push({artist:e.artists[0].name,track:e.name,album:e.album.name,popularity:e.popularity,spotify_id:e.id,spotify_url:e.uri,spotify_img_url:"",spotify_preview_url:e.preview_url})})),console.log("top tracks: ",n),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(2),e.abrupt("return",console.error(e.t0));case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),getMyTracks:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n,r,a,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=Object(p.a)(l.a.mark((function e(t){var n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("access_token")}});case 2:return n=e.sent,e.next=5,n.json();case 5:if(n=e.sent,r=document.getElementById("sync-btn"),s=Math.floor(a.length/n.total*100),r.setAttribute("disabled","disabled"),r.textContent=s+"%",console.log(s+"%"),n.items.forEach((function(e){a.push({artist:e.track.artists[0].name,track:e.track.name,album:e.track.album.name,popularity:e.track.popularity,spotify_id:e.track.id,spotify_url:e.track.uri,spotify_img_url:"",spotify_preview_url:e.track.preview_url})})),!n.next){e.next=16;break}c(n.next),e.next=18;break;case 16:return r.textContent="Termin\xe9 !",e.abrupt("return",x.syncMyTracks(a));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)},c=function(e){return s.apply(this,arguments)},e.next=4,x.getMyTopTracks("long_term");case 4:return t=e.sent,e.next=7,x.getMyTopTracks("medium_term");case 7:return n=e.sent,e.next=10,x.getMyTopTracks("short_term");case 10:r=e.sent,a=a.concat(t,n,r),console.log("top tracks RESULT :",a.length),"https://api.spotify.com/v1/me/tracks?limit=50",c("https://api.spotify.com/v1/me/tracks?limit=50");case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),registerMe:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return t=e.sent,console.log(t),n={name:t.display_name,spotify_login:t.id,email:t.email},console.log(JSON.stringify(n)),e.next=8,fetch("".concat(b,"/user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 8:return r=e.sent,e.t0=console,e.next=12,r.json();case 12:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),syncMyTracks:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return n=e.sent,r=n.id,console.log(r),e.next=7,fetch("".concat(b,"/user/").concat(r,"/tracks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 7:return a=e.sent,e.t0=console,e.next=11,a.json();case 11:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),syncMyMatchs:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyInfo();case 2:return t=e.sent,n=t.id,e.next=6,fetch("".concat(b,"/user/").concat(n,"/syncmatchs"));case 6:return r=e.sent,e.t0=console,e.next=10,r.json();case 10:e.t1=e.sent,e.t0.log.call(e.t0,e.t1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),syncAll:function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getMyTracks();case 2:return e.next=4,x.syncMyMatchs();case 4:return e.next=6,x.showMyMatchs();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};document.addEventListener("DOMContentLoaded",x.init);var y=x,g=function(e){return Object(j.jsxs)("div",{className:"Dashboard",children:[Object(j.jsx)("div",{className:"title",children:"Dashboard"}),Object(j.jsxs)("div",{className:"item-row",children:[Object(j.jsxs)("div",{className:"item",children:[Object(j.jsx)("img",{src:"/img/play-button.png",alt:""}),Object(j.jsxs)("div",{className:"item-desc--container",children:[Object(j.jsx)("div",{className:"item-title",children:"Ma musique"}),Object(j.jsx)("div",{className:"item-desc",children:"".concat(e.tracksCount," titres")||!1})]})]}),Object(j.jsx)("button",{id:"sync-btn",className:"button",onClick:e.btnFunction,children:"Synchroniser"})]}),Object(j.jsx)("div",{className:"item-row",children:Object(j.jsxs)("div",{className:"item",children:[Object(j.jsx)("img",{src:"/img/match.png",alt:""}),Object(j.jsxs)("div",{className:"item-desc--container",children:[Object(j.jsx)("div",{className:"item-title",children:"Mes Matchs"}),Object(j.jsx)("div",{className:"item-desc",children:"".concat(e.matchsCount," Matchs")})]})]})})]})};var v=function(e){var t=e.name;return Object(j.jsx)("div",{className:"Header",children:Object(j.jsxs)("nav",{className:"",role:"navigation","aria-label":"main navigation",children:[Object(j.jsx)("div",{className:"logo",children:Object(j.jsx)("a",{className:"navbar-item",href:"/",children:Object(j.jsx)("img",{src:"/img/logodegrade.png"})})}),t?Object(j.jsxs)("div",{className:"connected-user",children:[Object(j.jsx)("div",{className:"user",children:e.name}),Object(j.jsx)("img",{src:"/img/profile-user.png",alt:""})]}):null]})})},O=function(e){return Object(j.jsxs)("div",{className:"Matchboard",children:[Object(j.jsx)("div",{className:"title",children:"Mes Matchs"}),e.matchs.map((function(e){return Object(j.jsxs)("div",{className:"item-row",children:[Object(j.jsxs)("div",{className:"item",children:[Object(j.jsx)("span",{className:"logo-m shadow",children:Object(j.jsx)("img",{src:"/img/logo-m.png",alt:""})}),Object(j.jsx)("div",{className:"item-title",children:e.matchuser.name})]}),Object(j.jsxs)("div",{className:"item-desc--container",children:[Object(j.jsxs)("div",{className:"score",children:[e.score," points"]}),Object(j.jsxs)("div",{className:"item-desc",children:[e.tracksQty," titres en commun"]})]})]},e.matchuser.name)}))]})},k=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={username:"",tracks:[],matchs:[]},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("local storage : ",localStorage.getItem("isAuth")),t=new URL(window.location.href),!(n=t.searchParams.get("code"))||"true"==localStorage.getItem("isAuth")){e.next=6;break}return e.next=6,y.authProcess(n);case 6:return r=localStorage.getItem("connected_user_login"),console.log("login",r),e.next=10,y.showMyTracks(r);case 10:return a=e.sent,e.next=13,y.showMyMatchs(r);case 13:c=e.sent,this.setState({username:localStorage.getItem("connected_user_name")}),this.setState({tracks:a}),this.setState({matchs:c}),console.log("matchs :",c);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=function(){var e=Object(p.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.syncAll();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:"Home",children:[Object(j.jsx)(v,{name:this.state.username}),Object(j.jsxs)("div",{className:"home-container",children:[Object(j.jsx)("h2",{children:"Hello"}),Object(j.jsx)(g,{tracksCount:this.state.tracks.length,matchsCount:this.state.matchs.length,btnFunction:e}),Object(j.jsx)(O,{matchs:this.state.matchs})]})]})}}]),n}(r.Component),w=function(){var e=y.makeSpotifyConnectUrl();return localStorage.clear(),Object(j.jsxs)("div",{className:"landing-page",children:[Object(j.jsx)(v,{}),Object(j.jsxs)("div",{className:"connexion",children:[Object(j.jsx)("h1",{children:"Bienvenue"}),Object(j.jsx)("a",{href:e,children:Object(j.jsxs)("div",{className:"spotify-connect--btn",children:["Se connecter avec",Object(j.jsx)("img",{className:"spotify-connect--img",src:"/img/spotifyWhite.png",alt:""})]})})]})]})},_=function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)(v,{}),Object(j.jsx)("h1",{children:"Not Found"})]})};var N=function(){return Object(j.jsx)("div",{className:"App",children:Object(j.jsx)(o.a,{children:Object(j.jsxs)(i.c,{children:[Object(j.jsx)(i.a,{path:"/",exact:!0,component:w}),Object(j.jsx)(i.a,{path:"/home",exact:!0,component:k}),Object(j.jsx)(i.a,{component:_})]})})})};n(36);s.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(N,{})}),document.getElementById("root"))}},[[37,1,2]]]);